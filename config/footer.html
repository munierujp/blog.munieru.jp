<script>
(function () {
  const getCodeBlockElements = () => {
    return Array.from(document.querySelectorAll('.entry-content pre.code'))
  }

  const addLabelToCodeBlocks = () => {
    getCodeBlockElements().forEach(codeBlockElement => {
      const label = codeBlockElement.parentElement.dataset.label || codeBlockElement.dataset.lang

      if (label) {
        codeBlockElement.dataset.label = label
      }
    })
  }

  const isColorCode = (text) => {
    return text.match(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/)
  }

  const getColorCodeElements = () => {
    return Array.from(document.getElementsByTagName('code'))
      .filter(codeElement => isColorCode(codeElement.textContent))
  }

  const addColorCodePreviews = () => {
    getColorCodeElements().forEach(codeElement => {
      const color = codeElement.textContent
      codeElement.outerHTML = `${codeElement.outerHTML}<span class="jp-munieru-blog-color-code-preview" style="background-color: ${color};"></span>`
    })
  }

  const addScrollHintToTableElements = () => {
    // eslint-disable-next-line no-new
    new ScrollHint('.entry-content table')
  }

  const getExternalLinkElements = () => {
    return Array.from(document.querySelectorAll(`a[href^="http"]:not([href^="${location.origin}"])`))
  }

  const makeExternalLinkOpenInNewTab = () => {
    getExternalLinkElements().forEach(linkElement => {
      linkElement.setAttribute('target', '_blank')
      linkElement.setAttribute('rel', 'noopener noreferrer')
    })
  }

  window.addEventListener('DOMContentLoaded', () => {
    addLabelToCodeBlocks()
    addColorCodePreviews()
    addScrollHintToTableElements()
    makeExternalLinkOpenInNewTab()
  }, false)
})()
</script>
